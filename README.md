--- Bronze Layer PostgreSQL ---

CREATE SCHEMA IF NOT EXISTS BRONZE1;

CREATE TABLE BRONZE1.raw(
_STATE text,
FMONTH text,
IDATE text,
IMONTH text,
IDAY text,
IYEAR text,
DISPCODE text,
SEQNO text,
_PSU text,
CTELENUM text,
PVTRESD1 text,
COLGHOUS text,
STATERES text,
CELLFON3 text,
LADULT text,
NUMADULT text,
NUMMEN text,
NUMWOMEN text,
CTELNUM1 text,
CELLFON2 text,
CADULT text,
PVTRESD2 text,
CCLGHOUS text,
CSTATE text,
LANDLINE text,
HHADULT text,
GENHLTH text,
PHYSHLTH text,
MENTHLTH text,
POORHLTH text,
HLTHPLN1 text,
PERSDOC2 text,
MEDCOST text,
CHECKUP1 text,
BPHIGH4 text,
BPMEDS text,
BLOODCHO text,
CHOLCHK text,
TOLDHI2 text,
CVDINFR4 text,
CVDCRHD4 text,
CVDSTRK3 text,
ASTHMA3 text,
ASTHNOW text,
CHCSCNCR text,
CHCOCNCR text,
CHCCOPD1 text,
HAVARTH3 text,
ADDEPEV2 text,
CHCKIDNY text,
DIABETE3 text,
DIABAGE2 text,
SEX text,
MARITAL text,
EDUCA  text,
RENTHOM1 text,
NUMHHOL2 text,
NUMPHON2 text,
CPDEMO1 text,
VETERAN3 text,
EMPLOY1 text,
CHILDREN text,
INCOME2 text,
INTERNET text,
WEIGHT2 text,
HEIGHT3 text,
PREGNANT text, 
QLACTLM2 text,
USEEQUIP text,
BLIND text,
DECIDE text,
DIFFWALK text,
DIFFDRES text,
DIFFALON text,
SMOKE100 text,
SMOKDAY2 text,
STOPSMK2 text,
LASTSMK2 text,
USENOW3 text,
ALCDAY5 text,
AVEDRNK2 text,
DRNK3GE5 text, 
MAXDRNKS text,
FRUITJU1 text,
FRUIT1 text,
FVBEANS text,
FVGREEN text,
FVORANG text,
VEGETAB1 text,
EXERANY2 text, 
EXRACT11 text,
EXEROFT1 text,
EXERHMM1 text,
EXRACT21 text,
EXEROFT2 text,
EXERHMM2 text,
STRENGTH text,
LMTJOIN3 text,
ARTHDIS2 text,
ARTHSOCL text,
JOINPAIN text,
SEATBELT text,
FLUSHOT6 text,
FLSHTMY2 text,
IMFVPLAC text,
PNEUVAC3 text,
HIVTST6 text,
HIVTSTD3 text, 
WHRTST10 text,
PDIABTST text,
PREDIAB1 text,
INSULIN text,
BLDSUGAR text,
FEETCHK2 text,
DOCTDIAB text,
CHKHEMO3 text,
FEETCHK text,
EYEEXAM text,
DIABEYE text,
DIABEDU text,
PAINACT2 text,
QLMENTL2 text,
QLSTRES2 text,
QLHLTH2 text,
CAREGIV1 text,
CRGVREL1 text,
CRGVLNG1 text,
CRGVHRS1 text,
CRGVPRB1 text,
CRGVPERS text,
CRGVHOUS text,
CRGVMST2 text,
CRGVEXPT text,
VIDFCLT2 text,
VIREDIF3 text,
VIPRFVS2 text,
VINOCRE2 text,
VIEYEXM2 text,
VIINSUR2 text,
VICTRCT4 text,
VIGLUMA2 text,
VIMACDG2 text,
CIMEMLOS text,
CDHOUSE text,
CDASSIST text,
CDHELP text,
CDSOCIAL text,
CDDISCUS text,
WTCHSALT text,
LONGWTCH text,
DRADVISE text,
ASTHMAGE text,
ASATTACK text,
ASERVIST text,
ASDRVIST text,
ASRCHKUP text,
ASACTLIM text,
ASYMPTOM text,
ASNOSLEP text,
ASTHMED3 text,
ASINHALR text,
HAREHAB1 text,
STREHAB1 text,
CVDASPRN text,
ASPUNSAF text,
RLIVPAIN text,
RDUCHART text,
RDUCSTRK text,
ARTTODAY text,
ARTHWGT text,
ARTHEXER text,
ARTHEDU text,
TETANUS text,
HPVADVC2 text,
HPVADSHT text,
SHINGLE2 text,
HADMAM text,
HOWLONG text,
HADPAP2 text,
LASTPAP2 text,
HPVTEST text,
HPLSTTST text,
HADHYST2 text,
PROFEXAM text,
LENGEXAM text,
BLDSTOOL text,
LSTBLDS3 text,
HADSIGM3 text,
HADSGCO1 text,
LASTSIG3 text,
PCPSAAD2 text,
PCPSADI1 text,
PCPSARE1 text,
PSATEST1 text,
PSATIME text,
PCPSARS1 text,
PCPSADE1 text,
PCDMDECN text,
SCNTMNY1 text,
SCNTMEL1 text,
SCNTPAID text,
SCNTWRK1 text,
SCNTLPAD text,
SCNTLWK1 text,
SXORIENT text,
TRNSGNDR text,
RCSGENDR text,
RCSRLTN2 text,
CASTHDX2 text,
CASTHNO2 text,
EMTSUPRT text,
LSATISFY text,
ADPLEASR text,
ADDOWN text,
ADSLEEP text,
ADENERGY text,
ADEAT1 text,
ADFAIL text,
ADTHINK text,
ADMOVE text,
MISTMNT text,
ADANXEV text,
QSTVER text,
QSTLANG text,
EXACTOT1 text,
EXACTOT2 text,
MSCODE text,
_STSTR text,
_STRWT text,
_RAWRAKE text,
_WT2RAKE text,
_CHISPNC text,
_CRACE1 text,
_CPRACE text,
_CLLCPWT text,
_DUALUSE text,
_DUALCOR text,
_LLCPWT text,
_RFHLTH text,
_HCVU651 text,
_RFHYPE5 text,
_CHOLCHK text,
_RFCHOL text,
_MICHD text,
_LTASTH1 text,
_CASTHM1 text,
_ASTHMS1 text,
_DRDXAR1 text,
_PRACE1 text,
_MRACE1 text,
_HISPANC text,
_RACE text,
_RACEG21 text,
_RACEGR3 text,
_RACE_G1 text,
_AGEG5YR text,
_AGE65YR text,
_AGE80 text,
_AGE_G text,
HTIN4 text,
HTM4 text,
WTKG3 text,
_BMI5 text,
_BMI5CAT text,
_RFBMI5 text,
_CHLDCNT text,
_EDUCAG text,
_INCOMG text,
_SMOKER3 text,
_RFSMOK3 text,
DRNKANY5 text,
DROCDY3_ text,
_RFBING5 text,
_DRNKWEK text,
_RFDRHV5 text,
FTJUDA1_ text,
FRUTDA1_ text,
BEANDAY_ text,
GRENDAY_ text,
ORNGDAY_ text,
VEGEDA1_ text,
_MISFRTN text,
_MISVEGN text,
_FRTRESP text,
_VEGRESP text,
_FRUTSUM text,
_VEGESUM text,
_FRTLT1 text,
_VEGLT1 text,
_FRT16 text,
_VEG23 text,
_FRUITEX text,
_VEGETEX text,
_TOTINDA text,
METVL11_ text,
METVL21_ text,
MAXVO2_ text,
FC60_ text,
ACTIN11_ text,
ACTIN21_ text,
PADUR1_ text,
PADUR2_ text,
PAFREQ1_ text,
PAFREQ2_ text,
_MINAC11 text,
_MINAC21 text,
STRFREQ_ text,
PAMISS1_ text,
PAMIN11_ text,
PAMIN21_ text,
PA1MIN_ text,
PAVIG11_ text,
PAVIG21_ text,
PA1VIGM_ text,
_PACAT1 text,
_PAINDX1 text,
_PA150R2 text,
_PA300R2 text,
_PA30021 text,
_PASTRNG text,
_PAREC1 text,
_PASTAE1 text,
_LMTACT1 text,
_LMTWRK1 text,
_LMTSCL1 text,
_RFSEAT2 text,
_RFSEAT3 text,
_FLSHOT6 text,
_PNEUMO2 text,
_AIDTST3 text
) 

select * from BRONZE1.raw 

select count(*) from BRONZE1.raw 

select 
_STATE ,
FMONTH ,
IDATE ,
IMONTH ,
IDAY ,
IYEAR ,
DISPCODE ,
SEQNO ,
_PSU ,
CTELENUM ,
PVTRESD1 ,
COLGHOUS ,
STATERES ,
CELLFON3 ,
LADULT ,
NUMADULT ,
NUMMEN ,
NUMWOMEN ,
CTELNUM1 ,
CELLFON2 ,
CADULT ,
PVTRESD2 ,
CCLGHOUS ,
CSTATE ,
LANDLINE ,
HHADULT ,
GENHLTH ,
PHYSHLTH ,
MENTHLTH ,
POORHLTH ,
HLTHPLN1 ,
PERSDOC2 ,
MEDCOST ,
CHECKUP1 ,
BPHIGH4 ,
BPMEDS ,
BLOODCHO ,
CHOLCHK ,
TOLDHI2 ,
CVDINFR4 ,
CVDCRHD4 ,
CVDSTRK3 ,
ASTHMA3 ,
ASTHNOW,
CHCSCNCR ,
CHCOCNCR ,
CHCCOPD1 ,
HAVARTH3 ,
ADDEPEV2 ,
CHCKIDNY 
from BRONZE1.raw limit 10

-----Silver Layer PosgreSQL ---

CREATE SCHEMA IF NOT EXISTS SILVER1;

CREATE TABLE SILVER1.cleaned(
state': Integer(),
    survey_month int,
    survey_date date,
    month int, 
   day int,
    year int,
    disposition_code int,
    sequence_number bigint,        
    primary_sampling_unit bigint,   
    telephone_number int,      
    private_residence int,
    college_house int,
    state_residence int,
    cell_phone int,
    num_living_adults int,
   num_of_adults int,
    num_of_men int,
    num_of_women int,
    ctelnum1 int,
    cellfon2 int,
    cadult int,
    private_residence_2 int,
    college_house_2 int,
    cstate int,
    landline int,
    household_adults int,
    general_health int,
    physical_health_days int,
    mental_health_days int,
    poor_health_days int,
    has_health_plan int,
    has_personal_doctor int,
    medical_cost_issue int,
    last_checkup int,
    high_blood_pressure int,
    bp_meds int,
    high_cholesterol int,
    cholesterol_check int,
    diagnosed_diabetes int,
    had_heart_attack int,
    had_coronary_heart_disease int,
    had_stroke int,
    has_asthma int,
    asthma_now int,
    had_skin_cancer int,
    had_other_cancer int,
    has_copd int,
   has_arthritis int,
    has_depression int,
    had_kidney_disease int
) 

select * from  SILVER1.cleaned

--- Gold Layer PostgreSQL ---

CREATE SCHEMA IF NOT EXISTS GOLD1

CREATE TABLE GOLD1.presentation(
state int,
    survey_month int,
    survey_date date,
    month int, 
   day int,
    year int,
    disposition_code int,
    sequence_number bigint,        
    primary_sampling_unit bigint,   
    telephone_number int,      
    private_residence int,
    state_residence int,
    cell_phone int,
   num_of_adults int,
    num_of_men int,
    num_of_women int,
    general_health int,
    physical_health_days int,
    mental_health_days int,
    poor_health_days int,
    has_health_plan int,
    has_personal_doctor int,
    medical_cost_issue int,
    last_checkup int,
    high_blood_pressure int,
    high_cholesterol int,
    cholesterol_check int,
    diagnosed_diabetes int,
    had_heart_attack int,
    had_coronary_heart_disease int,
    had_stroke int,
    has_asthma int,
    had_skin_cancer int,
    had_other_cancer int,
    has_copd int,
   has_arthritis int,
    has_depression int,
    had_kidney_disease int
) 

select * from  GOLD1.presentation

-- See your sampled rows
SELECT COUNT(*) FROM GOLD1.presentation;

-- Top states by sample size
SELECT state, COUNT(*) AS rows
FROM GOLD1.presentation
GROUP BY state
ORDER BY rows DESC
LIMIT 10;

select * from GOLD1.condition_count_by_state

---

create table GOLD1.condition_count_by_state as
select state , 
count (*) filter( where high_blood_pressure = 1 ) as high_blood_pressure ,
count (*) filter( where high_cholesterol = 1 ) as high_cholesterol ,
count (*) filter( where diagnosed_diabetes = 1 ) as diagnosed_diabetes ,
count (*) filter( where had_heart_attack = 1 ) as had_heart_attack ,
count (*) filter( where had_coronary_heart_disease = 1 ) as had_coronary_heart_disease, 
count (*) filter( where had_skin_cancer = 1 ) as had_skin_cancer ,
count (*) filter( where has_asthma = 1 ) as has_asthma ,
count (*) filter( where had_other_cancer = 1 ) as had_other_cancer ,
count (*) filter( where has_copd = 1 ) as has_copd ,
count (*) filter( where has_arthritis = 1 ) as has_arthritis ,
count (*) filter( where has_depression = 1 ) as has_depression ,
count (*) filter( where had_kidney_disease = 1 ) as had_kidney_disease 
from GOLD1.presentation group by state 

create 

--- TABLES---

--Total number of columns in database
SELECT table_schema,
       table_name,
       COUNT(*) AS column_count
FROM information_schema.columns
WHERE table_schema NOT IN ('information_schema', 'pg_catalog')
GROUP BY table_schema, table_name
ORDER BY column_count DESC;

--This table contains aggregated health metrics by state and month. It’s designed for prevalence analysis
select * from gold1.metrics_by_state_month

--This table contains total respondants total disease , avg_disease_count , prevalance_any_disease aggreagated by state.
select * from gold1.metrics_burden_by_state

--Simple counts of each condition per state—useful for dashboards and ranking states by each condition.
select * from gold1.condition_counts_by_state

--Are people without a health plan or personal doctor experiencing worse outcomes or more poor health days?
select * from gold1.access_vs_burden_state

--This table contains aggregated health metrics by state. It’s designed for prevalence analysis and data quality checks.
select * from gold1.metrics_by_state


